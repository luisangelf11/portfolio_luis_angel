---
import Image from "astro/components/Image.astro";
import notas from "../assets/notas.png";
import nest from "../assets/nest.jpg";
import chat from "../assets/chat.jpg";

const projects = [
  {
    name: "Dev Community",
    desc: "It's a chat application for developers like discord, where you can meet and talk to others developers of the community. This is a personal project.",
    images: [chat],
    skills: ["nest js", "tailwind", "typescript", "react", "sqlite"],
    github: "https://github.com/luisangelf11/dev-community",
    preview: "",
  },
  {
    name: "Notes App",
    desc: "This is a notes app developed at a live event for my YouTube subscribers. This app performs a basic CRUD",
    images: [notas],
    skills: ["react", "tailwind", "express", "prisma"],
    github: "https://github.com/luisangelf11/js-dev4ever",
    preview:
      "https://youtube.com/playlist?list=PL65l-wzLB2dedgjoGOG9ABcQCDXuJTySC&si=aeBKdT-OPBAR9XeQ",
  },
  {
    name: "Tasks Manager API",
    desc: "This is a Rest API developed with nest, it handles user authentication and allows performing all crud operations for the logged-in user.",
    images: [nest],
    skills: ["nest js", "prisma"],
    github: "https://github.com/luisangelf11/task-manager-api",
    preview: "",
  },
];
---

<article id="projects" class="flex flex-col gap-4 justify-center items-center">
  <h2
    class="text-2xl font-extrabold text-white uppercase flex justify-center items-center gap-3 reveal"
  >
    <span>My Projects</span>
  </h2>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-8">
    {
      projects.map((project, index) => (
        <div
          class="project-card group relative w-[300px] h-[200px] rounded-lg overflow-hidden shadow-lg cursor-pointer reveal"
          data-project-index={index}
        >
          <Image
            src={project.images[0]}
            alt={project.name}
            class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
            width={300}
            height={200}
          />
          <div class="absolute inset-0 bg-black bg-opacity-60 flex flex-col justify-end p-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
            <h3 class="text-xl text-yellow-300 uppercase font-bold">
              {project.name}
            </h3>
            <p class="text-xs text-white text-justify mt-2">{project.desc}</p>
          </div>
        </div>
      ))
    }
  </div>
</article>

<!-- Modal Structure -->
<div
  id="project-modal"
  class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden items-center justify-center"
>
  <div
    id="modal-content"
    class="relative bg-slate-900 p-4 rounded-lg max-w-4xl w-11/12"
  >
    <button
      id="close-modal"
      class="absolute top-3 right-3 text-white hover:text-yellow-400 z-20"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="size-7"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M6 18 18 6M6 6l12 12"></path>
      </svg>
    </button>

    <!-- Project Info -->
    <div class="mt-4 text-white">
      <h3 id="modal-title" class="text-2xl text-yellow-300 uppercase font-bold">
      </h3>
      <p id="modal-desc" class="text-sm mt-2"></p>
      <div id="modal-skills" class="flex flex-wrap gap-2 mt-4"></div>
      <div id="modal-links" class="flex gap-4 mt-4"></div>
    </div>

    <!-- Image Grid Container -->
    <div id="image-grid" class="grid grid-cols-2 gap-2 mt-4">
      <!-- Images and placeholders will be injected here by JS -->
    </div>
  </div>
</div>

<script define:vars={{ projects }}>
  document.addEventListener("DOMContentLoaded", () => {
    const projectCards = document.querySelectorAll(".project-card");
    const modal = document.getElementById("project-modal");
    const closeModalBtn = document.getElementById("close-modal");
    const imageGrid = document.getElementById("image-grid");

    const modalTitle = document.getElementById("modal-title");
    const modalDesc = document.getElementById("modal-desc");
    const modalSkills = document.getElementById("modal-skills");
    const modalLinks = document.getElementById("modal-links");

    let currentProject = null;

    const openModal = (projectIndex) => {
      currentProject = projects[projectIndex];

      // Populate Modal Info
      modalTitle.textContent = currentProject.name;
      modalDesc.textContent = currentProject.desc;

      modalSkills.innerHTML = currentProject.skills
        .map(
          (skill) =>
            `<span class="p-2 rounded-lg text-xs text-blue-400 font-bold bg-slate-800">${skill}</span>`
        )
        .join("");

      modalLinks.innerHTML = `
        ${
          currentProject.github
            ? `<a href="${currentProject.github}" target="_blank" rel="noopener noreferrer" class="flex justify-center items-center text-white gap-2 border rounded-lg p-2 text-xs transition-all hover:text-yellow-400 hover:border-blue-400 hover:bg-slate-800">
                <svg viewBox="0 0 256 250" width="15" height="15" fill="currentColor" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Z"/></svg>
                <span>Code</span>
              </a>`
            : ""
        }
        ${
          currentProject.preview
            ? `<a href="${currentProject.preview}" target="_blank" rel="noopener noreferrer" class="flex justify-center items-center text-white gap-2 border rounded-lg p-2 text-xs transition-all hover:text-yellow-400 hover:border-blue-400 hover:bg-slate-800">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-5"><path d="M15.75 8.25a.75.75 0 0 1 .75.75c0 1.12-.492 2.126-1.27 2.812a.75.75 0 1 1-.992-1.124A2.243 2.243 0 0 0 15 9a.75.75 0 0 1 .75-.75Z" /><path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM4.575 15.6a8.25 8.25 0 0 0 9.348 4.425 1.966 1.966 0 0 0-1.84-1.275.983.983 0 0 1-.97-.822l-.073-.437c-.094-.565.25-1.11.8-1.267l.99-.282c.427-.123.783-.418.982-.816l.036-.073a1.453 1.453 0 0 1 2.328-.377L16.5 15h.628a2.25 2.25 0 0 1 1.983 1.186 8.25 8.25 0 0 0-6.345-12.4c.044.262.18.503.389.676l1.068.89c.442.369.535 1.01.216 1.49l-.51.766a2.25 2.25 0 0 1-1.161.886l-.143.048a1.107 1.107 0 0 0-.57 1.664c.369.555.169 1.307-.427 1.605L9 13.125l.423 1.059a.956.956 0 0 1-1.652.928l-.679-.906a1.125 1.125 0 0 0-1.906.172L4.575 15.6Z" clip-rule="evenodd" /></svg>
                <span>Preview</span>
              </a>`
            : ""
        }
      `;

      updateImageGrid();
      modal.classList.remove("hidden");
      modal.classList.add("flex");
      document.body.style.overflow = "hidden"; // Prevent background scrolling
    };

    const closeModal = () => {
      modal.classList.add("hidden");
      modal.classList.remove("flex");
      document.body.style.overflow = "auto"; // Restore scrolling
    };

    const updateImageGrid = () => {
      imageGrid.innerHTML = "";
      const placeholderSvg = `
        <div class="w-full h-full bg-slate-800 rounded-md flex items-center justify-center">
          <svg class="w-12 h-12 text-slate-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
          </svg>
        </div>
      `;

      for (let i = 0; i < 4; i++) {
        if (i < currentProject.images.length) {
          const img = currentProject.images[i];
          imageGrid.innerHTML += `<img src="${img.src}" alt="${currentProject.name} - Image ${i + 1}" class="w-full h-full object-cover rounded-md">`;
        } else {
          imageGrid.innerHTML += placeholderSvg;
        }
      }
    };

    projectCards.forEach((card) => {
      card.addEventListener("click", () => {
        const projectIndex = card.getAttribute("data-project-index");
        openModal(parseInt(projectIndex, 10));
      });
    });

    closeModalBtn.addEventListener("click", closeModal);
    modal.addEventListener("click", (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });

    // Keyboard navigation
    document.addEventListener("keydown", (e) => {
      if (modal.classList.contains("flex")) {
        if (e.key === "Escape") closeModal();
      }
    });
  });
</script>

<style>
  #carousel-images > img {
    flex-shrink: 0; /* This can be removed if not used elsewhere */
  }
</style>
